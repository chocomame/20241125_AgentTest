# 検品チェック6選 構造説明

## 1. 基本設定と依存関係
- streamlit: WebアプリケーションフレームワークとしてStreamlitを使用
- requests: HTTPリクエスト用
- BeautifulSoup4: HTML解析用
- pandas: データ処理用
- janome: 形態素解析用
- その他の標準ライブラリ（re, urllib.parse, warnings, html.parser）

## 2. クラスと主要機能

### 2.1 HTMLSyntaxChecker クラス
- HTMLParserを継承したカスタムパーサー
- HTML構文のエラーチェック機能
- タグの開始・終了の整合性チェック
- エラー位置（行番号、列）の追跡

### 2.2 主要機能関数

#### check_html_syntax(html_content)
- HTMLの閉じタグをチェック
- PHPコードと特殊文字の一時的な置換処理
- 重要なタグ（div, p, section等）の構造チェック
- エラー位置と文脈の報告
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - エラーあり: ❌ 警告: [タグ名]タグの閉じ忘れが1個あります: → 行 [行番号]: [タグの内容]

#### normalize_url(url)
- URLの正規化処理
- 日本語URLのデコード（UTF-8）
  - unquote関数を使用して日本語URLを可読形式に変換
  - エンコードされたURLを人間が読める日本語表示に変換
- index.htmlの正規化
- スラッシュの統一

#### is_same_domain(url, base_domain)
- 同一ドメインチェック

#### is_anchor_link(url)
- アンカーリンクの判定

#### contains_japanese(text)
- 日本語文字の含有チェック

#### check_heading_order(soup)
- 見出しタグ（h1-h6）の順序チェック
- 英語のみの見出しの検出
- 見出しレベルの飛びのチェック
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - エラーあり: 
    - 見出し構造の問題: [問題の説明]
    - 英語のみの見出し: [該当の見出し]

#### check_image_alt(soup, url)
- 画像のalt属性チェック
- ブログ・カテゴリーページのスキップ処理
- 画像URLの正規化と検証
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - 画像なし: - 画像なし
  - スキップ: skip
  - エラーあり: ❌ alt属性なし: [画像のURL]

#### check_keyword_repetition(text)
- テキスト内のキーワード重複をチェック（形態素解析使用）
- テキストの前処理
  - 空のテキストチェック
  - 2文字未満の単語を除外
- 医療用語の除外処理
  - 完全一致による除外（例：「内科」「外科」など）
  - 部分一致による除外（例：「皮膚科」から「皮膚」を除外）
  - 医療用語から2文字以上の部分文字列を自動抽出
- 品詞による除外
  - 助詞（の、や、が、を、に、へ、で、から、まで、よ、も、は）
  - 助動詞（です、ます、など）
  - 記号（・、|、-）
  - 接続詞
  - 感動詞
  - 副詞
  - 連体詞
- 形態素解析処理
  - Janomeトークナイザーによる単語分割
  - 品詞情報の取得
  - 表層形（実際の単語）の取得
- 重複判定
  - 名詞のみを対象として出現回数をカウント
  - 3回以上出現する単語を重複として検出
  - 出現回数の多い順にソート
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - エラーあり: 
    - タイトル超過: ❌ 長すぎます（50文字以内推奨）
    - ディスクリプション超過: ❌ 長すぎます（140文字以内推奨）
    - キーワード重複: 
      ⚠️ キーワードの重複：
      1. '[キーワード]' が[回数]回出現
      2. '[キーワード]' が[回数]回出現

## 3. メイン処理（main関数）

### 3.1 UI構成
- ページ設定（幅、タイトル等）
- カスタムCSS適用
- バージョン情報と変更履歴の表示
- 機能説明の表示

### 3.2 チェック処理フロー
1. URL入力フォームの表示
2. チェック開始ボタンの処理
3. プログレスバーによる進捗表示
4. 結果の表示（6つのタブ形式）
   - 📝 タイトル・ディスクリプション
   - 📑 見出し構造
   - 🔤 英語のみの見出し
   - 🖼️ 画像alt属性
   - 🔧 HTML構文
   - ⚠️ 404エラー

### 3.3 結果表示
- DataFrameを使用したデータ整形
- HTMLリンクの生成
  - 各タブでのURL表示時に日本語URLを正しく表示
  - クリック可能なリンクとして表示
  - URLの重複表示防止
- カスタムスタイル適用
  - エラーメッセージの色分け（赤：エラー、緑：OK、黄：警告）
  - モノスペースフォントでのコード表示
  - 適切なインデントとスペーシング
- エラーメッセージの表示形式
  - 改行を使用して見やすく表示（<br>タグ使用）
  - 半角コロンを全角コロン（：）に統一
  - エラー内容を階層的に表示
  - 重複キーワードは番号付きリストで表示

## 4. エラー処理
- リクエストエラーの処理
- 404エラーの特別処理
- エンコーディング自動検出
- タイムアウト設定
- 日本語URLのエンコーディングエラー処理

## 5. 制限事項
- 同一ドメインのみチェック
- プレビューURLはスキップ
- PDFファイルはスキップ
- ブログ・カテゴリーページでの画像チェックはスキップ

## 6. パフォーマンス考慮事項
- タイムアウト設定（10秒）
- User-Agentヘッダーの設定
- エンコーディング自動検出
- 結果の上限（50件）設定 