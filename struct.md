# 検品チェック6選 構造説明

## 1. 基本設定と依存関係
- streamlit: WebアプリケーションフレームワークとしてStreamlitを使用
- requests: HTTPリクエスト用
- BeautifulSoup4: HTML解析用
- pandas: データ処理用
- その他の標準ライブラリ（re, urllib.parse, warnings, html.parser）

## 2. クラスと主要機能

### 2.1 HTMLSyntaxChecker クラス
- HTMLParserを継承したカスタムパーサー
- HTML構文のエラーチェック機能
- タグの開始・終了の整合性チェック
- エラー位置（行番号、列）の追跡

### 2.2 主要機能関数

#### check_html_syntax(html_content)
- HTMLの閉じタグをチェック
- PHPコードと特殊文字の一時的な置換処理
- 重要なタグ（div, p, section等）の構造チェック
- エラー位置と文脈の報告
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - エラーあり: ❌ 警告: [タグ名]タグの閉じ忘れが1個あります: → 行 [行番号]: [タグの内容]

#### normalize_url(url)
- URLの正規化処理
- 日本語URLのデコード（UTF-8）
  - unquote関数を使用して日本語URLを可読形式に変換
  - エンコードされたURLを人間が読める日本語表示に変換
- index.htmlの正規化
- スラッシュの統一

#### is_same_domain(url, base_domain)
- 同一ドメインチェック

#### is_anchor_link(url)
- アンカーリンクの判定

#### contains_japanese(text)
- 日本語文字の含有チェック

#### check_heading_order(soup)
- 見出しタグ（h1-h6）の順序チェック
- 英語のみの見出しの検出
- 見出しレベルの飛びのチェック
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - エラーあり: 
    - 見出し構造の問題: [問題の説明]
    - 英語のみの見出し: [該当の見出し]

#### check_image_alt(soup, url)
- 画像のalt属性チェック
- ブログ・カテゴリーページのスキップ処理
- 画像URLの正規化と検証
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - 画像なし: - 画像なし
  - スキップ: skip
  - エラーあり: ❌ alt属性なし: [画像のURL]

#### check_keyword_repetition(text)
- テキスト内のキーワード重複をチェック
- テキストの前処理
  - 句読点、括弧などを空白に置換
  - 複数の空白を1つの空白に統一
- ストップワード（無視する単語）の定義と除外
  - 助詞（の、や、が、を、に、へ、で、から、まで、よ、も、は）
  - 記号（・、|、-）
  - 一般的な語尾（です、ます、した、など）
  - 代名詞（これ、それ、あれ、この、など）
  - 敬称（さん、様、氏、方）
  - その他の一般的な単語（ない、あり、なし、とき、もの、こと、など）
- 診療科関連の用語（重複チェック対象外）
  - 基本診療科（内科、外科、眼科、歯科など）
  - 歯科の専門分野（小児歯科、矯正歯科、審美歯科、口腔外科など）
  - 内科の専門分野（消化器内科、循環器内科、脳神経内科など）
  - その他の専門分野（消化器外科、心臓血管外科など）
  - 医療機関を表す一般的な用語（病院、クリニック、医院、診療所）
- 単語抽出処理
  - 固定パターン（地名など）の抽出（例：八王子）
  - 2文字以上の連続した漢字、ひらがな、カタカナの抽出
  - 単語の位置情報を記録し、重複を防止
  - 固定パターンと一般単語の重複を防止
- 重複判定
  - ストップワードと診療科用語を除外
  - 単語の出現位置に基づいて重複を判定
  - 同一キーワードが3回以上出現した場合に警告
  - 2回までの出現はOKとして扱う
- エラーメッセージの形式：
  - エラーなし: ✅ OK
  - エラーあり: 
    - タイトル超過: ❌ 長すぎます（50文字以内推奨）
    - ディスクリプション超過: ❌ 長すぎます（140文字以内推奨）
    - キーワード重複: 
      ⚠️ キーワードの重複：
      1. '[キーワード]' が[回数]回出現
      2. '[キーワード]' が[回数]回出現

## 3. メイン処理（main関数）

### 3.1 UI構成
- ページ設定（幅、タイトル等）
- カスタムCSS適用
- バージョン情報と変更履歴の表示
- 機能説明の表示

### 3.2 チェック処理フロー
1. URL入力フォームの表示
2. チェック開始ボタンの処理
3. プログレスバーによる進捗表示
4. 結果の表示（6つのタブ形式）
   - 📝 タイトル・ディスクリプション
   - 📑 見出し構造
   - 🔤 英語のみの見出し
   - 🖼️ 画像alt属性
   - 🔧 HTML構文
   - ⚠️ 404エラー

### 3.3 結果表示
- DataFrameを使用したデータ整形
- HTMLリンクの生成
  - 各タブでのURL表示時に日本語URLを正しく表示
  - クリック可能なリンクとして表示
  - URLの重複表示防止
- カスタムスタイル適用
  - エラーメッセージの色分け（赤：エラー、緑：OK、黄：警告）
  - モノスペースフォントでのコード表示
  - 適切なインデントとスペーシング
- エラーメッセージの表示形式
  - 改行を使用して見やすく表示（<br>タグ使用）
  - 半角コロンを全角コロン（：）に統一
  - エラー内容を階層的に表示
  - 重複キーワードは番号付きリストで表示

## 4. エラー処理
- リクエストエラーの処理
- 404エラーの特別処理
- エンコーディング自動検出
- タイムアウト設定
- 日本語URLのエンコーディングエラー処理

## 5. 制限事項
- 同一ドメインのみチェック
- プレビューURLはスキップ
- PDFファイルはスキップ
- ブログ・カテゴリーページでの画像チェックはスキップ

## 6. パフォーマンス考慮事項
- タイムアウト設定（10秒）
- User-Agentヘッダーの設定
- エンコーディング自動検出
- 結果の上限（50件）設定 