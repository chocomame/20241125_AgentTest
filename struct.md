# WEBサイトSEOチェッカー構造説明

## 1. 基本設定と依存関係
- streamlit: WebアプリケーションフレームワークとしてStreamlitを使用
- requests: HTTPリクエスト用
- BeautifulSoup4: HTML解析用
- pandas: データ処理用
- その他の標準ライブラリ（re, urllib.parse, warnings, html.parser）

## 2. クラスと主要機能

### 2.1 HTMLSyntaxChecker クラス
- HTMLParserを継承したカスタムパーサー
- HTML構文のエラーチェック機能
- タグの開始・終了の整合性チェック
- エラー位置（行番号、列）の追跡

### 2.2 主要機能関数

#### check_html_syntax(html_content)
- HTMLの閉じタグをチェック
- PHPコードと特殊文字の一時的な置換処理
- 重要なタグ（div, p, section等）の構造チェック
- エラー位置と文脈の報告

#### normalize_url(url)
- URLの正規化処理
- 日本語URLのデコード（UTF-8）
  - unquote関数を使用して日本語URLを可読形式に変換
  - エンコードされたURLを人間が読める日本語表示に変換
- index.htmlの正規化
- スラッシュの統一

#### is_same_domain(url, base_domain)
- 同一ドメインチェック

#### is_anchor_link(url)
- アンカーリンクの判定

#### contains_japanese(text)
- 日本語文字の含有チェック

#### check_heading_order(soup)
- 見出しタグ（h1-h6）の順序チェック
- 英語のみの見出しの検出
- 見出しレベルの飛びのチェック

#### check_image_alt(soup, url)
- 画像のalt属性チェック
- ブログ・カテゴリーページのスキップ処理
- 画像URLの正規化と検証

#### check_keyword_repetition(text)
- テキスト内のキーワード重複をチェック
- ストップワード（無視する単語）の定義と除外
  - 助詞（の、や、が、を、に、へ、で、から、まで、よ、も、は）
  - 記号（・、|、-）
- 許療科関連の用語（重複チェック対象外）
  - 基本診療科（内科、外科、眼科、歯科など）
  - 歯科の専門分野（小児歯科、矯正歯科、審美歯科、口腔外科など）
  - 内科の専門分野（消化器内科、循環器内科、脳神経内科など）
  - その他の専門分野（消化器外科、心臓血管外科など）
  - 医療機関を表す一般的な用語（病院、クリニック、医院、診療所）
- 複合語の認識と処理
  - 3単語までの複合語を優先的に検出
  - 診療科の複合語を個別の専門分野として認識
  - 複合語は1つのキーワードとして扱う
- キーワード抽出ルール
  - 2文字以上の単語のみを対象
  - ストップワードは除外
  - 日本語、英数字に対応
  - 診療科関連の用語は重複カウントから除外
- 重複判定
  - 診療科以外の一般的な単語のみを対象
  - 同一キーワードが3回以上出現した場合に警告
  - 2回までの出現はOKとして扱う
- 結果の形式
  - 重複キーワードと出現回数を表示（例：'キーワード' (3回)）
  - 複数の重複キーワードがある場合はカンマで区切って表示

#### get_page_info(url)
- ページの基本情報取得
- タイトル・ディスクリプションの取得
  - タイトルの文字数チェック（50文字以内）
  - ディスクリプションの文字数チェック（140文字以内）
  - キーワード重複チェック
    - タイトル、ディスクリプションそれぞれで重複をチェック
    - 文字数超過と重複の両方がある場合は両方を表示
    - 問題がない場合は「✅ OK」を表示
    - 文字数超過は「❌」、キーワード重複は「⚠️」で警告
- 各種チェック機能の統合（見出し、画像、HTML構文）
- 正規化されたURLの使用（日本語URLの適切な処理）

#### get_all_links(url, base_domain)
- ページ内の全リンク取得
- 同一ドメインのリンクのみ抽出
- リンクの正規化
- 特殊なURLの除外（PDF、プレビュー等）

#### is_preview_url(url)
- プレビューURLの判定
- 特定のクエリパラメータのチェック

## 3. メイン処理（main関数）

### 3.1 UI構成
- ページ設定（幅、タイトル等）
- カスタムCSS適用
- バージョン情報と変更履歴の表示
- 機能説明の表示

### 3.2 チェック処理フロー
1. URL入力フォームの表示
2. チェック開始ボタンの処理
3. プログレスバーによる進捗表示
4. 結果の表示（6つのタブ形式）
   - タイトル・ディスクリプション
   - 見出し構造
   - 英語のみの見出し
   - 画像alt属性
   - HTML構文
   - 404エラーページ

### 3.3 結果表示
- DataFrameを使用したデータ整形
- HTMLリンクの生成
  - 各タブでのURL表示時に日本語URLを正しく表示
  - クリック可能なリンクとして表示
  - URLの重複表示防止
- カスタムスタイル適用

## 4. エラー処理
- リクエストエラーの処理
- 404エラーの特別処理
- エンコーディング自動検出
- タイムアウト設定
- 日本語URLのエンコーディングエラー処理

## 5. 制限事項
- 同一ドメインのみチェック
- プレビューURLはスキップ
- PDFファイルはスキップ
- ブログ・カテゴリーページでの画像チェックはスキップ

## 6. パフォーマンス考慮事項
- タイムアウト設定（10秒）
- User-Agentヘッダーの設定
- エンコーディング自動検出
- 結果の上限（50件）設定 